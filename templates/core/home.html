{% extends 'base.html' %}

{% block title %}dj-apprunner-template - Panel de Control{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto p-4 space-y-6 font-sans text-sm">
    <!-- Header minimalista -->
    <div class="text-center mb-8">
        <h1 class="text-2xl font-light text-gray-700 mb-2">dj-apprunner-template</h1>
        <p class="text-gray-500 text-xs">
            Template para proyectos Django en AWS App Runner
        </p>
    </div>

    <!-- Grid de Verificaci√≥n Tecnol√≥gica -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6">
        <!-- Vite -->
        <div class="bg-white border border-gray-200 p-3">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm font-medium text-gray-700">Vite</h3>
                <span class="text-xs px-2 py-0.5 rounded-full" id="vite-status">üîÑ</span>
            </div>
            <table class="w-full text-xs text-gray-500">
                <tr>
                    <td class="w-1/2">HMR:</td>
                    <td id="hmr-status">{{ environment|yesno:"‚úÖ,üîÑ" }}</td>
                </tr>
                <tr>
                    <td>Build:</td>
                    <td id="build-status">Verificando...</td>
                </tr>
            </table>
        </div>

        <!-- Tailwind -->
        <div class="bg-white border border-gray-200 p-3">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm font-medium text-gray-700">Tailwind</h3>
                <span class="text-xs px-2 py-0.5 rounded-full bg-green-50 text-green-700">‚úÖ</span>
            </div>
            <table class="w-full text-xs text-gray-500">
                <tr>
                    <td class="w-1/2">Versi√≥n:</td>
                    <td>v3.4.1</td>
                </tr>
                <tr>
                    <td>Estado:</td>
                    <td>Activo</td>
                </tr>
            </table>
        </div>

        <!-- HTMX -->
        <div class="bg-white border border-gray-200 p-3">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-sm font-medium text-gray-700">HTMX</h3>
                <span class="text-xs px-2 py-0.5 rounded-full" id="htmx-status">üîÑ</span>
            </div>
            <table class="w-full text-xs text-gray-500">
                <tr>
                    <td class="w-1/2">Versi√≥n:</td>
                    <td id="htmx-version">Detectando...</td>
                </tr>
                <tr>
                    <td>Test:</td>
                    <td>
                        <button 
                            hx-get="{% url 'htmx_demo' %}"
                            hx-target="#htmx-demo-result" 
                            hx-swap="outerHTML"
                            class="text-xs text-blue-600 hover:text-blue-800">
                            Probar
                        </button>
                        <span id="htmx-demo-result" class="text-gray-400">‚Üí</span>
                    </td>
                </tr>
            </table>
        </div>
    </div>

    <!-- Links de Prueba -->
    <div class="bg-white border border-gray-200 p-3 mb-6">
        <h2 class="text-sm font-medium text-gray-700 mb-3">Pruebas Disponibles</h2>
        <div class="flex flex-wrap gap-2">
            <a href="{% url 'health' %}" class="text-xs text-blue-600 hover:text-blue-800">Health Check</a>
            <span class="text-gray-300">|</span>
            <a href="{% url 'db_health_check' %}" class="text-xs text-blue-600 hover:text-blue-800">DB Health</a>
            <span class="text-gray-300">|</span>
            <a href="{% url 'hello_world' %}" class="text-xs text-blue-600 hover:text-blue-800">Hello World</a>
        </div>
    </div>

    <!-- README -->
    <div class="bg-white border border-gray-200 p-3">
        <h2 class="text-sm font-medium text-gray-700 mb-3">Documentaci√≥n</h2>
        <div class="prose prose-sm max-w-none text-gray-600">
            <h3 class="text-xs font-medium text-gray-700 mb-2">Stack Tecnol√≥gico</h3>
            <table class="w-full text-xs">
                <tr>
                    <td class="w-1/4 py-1">Backend:</td>
                    <td class="py-1">Python {{ python_version }}, Django {{ django_version }}, Gunicorn</td>
                </tr>
                <tr>
                    <td class="py-1">Database:</td>
                    <td class="py-1">PostgreSQL (RDS)</td>
                </tr>
                <tr>
                    <td class="py-1">Storage:</td>
                    <td class="py-1">S3 + CloudFront</td>
                </tr>
                <tr>
                    <td class="py-1">Deploy:</td>
                    <td class="py-1">AWS App Runner</td>
                </tr>
                <tr>
                    <td class="py-1">Frontend:</td>
                    <td class="py-1">Vite, Tailwind, HTMX</td>
                </tr>
            </table>
        </div>
    </div>
</div>

<!-- JavaScript para verificaciones -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Verificar Vite
    const originalLog = console.log;
    let viteMessageDetected = false;
    
    console.log = function(...args) {
        if (args.some(arg => typeof arg === 'string' && arg.includes('Vite'))) {
            viteMessageDetected = true;
            updateViteStatus(true);
        }
        originalLog.apply(console, args);
    };
    
    checkManifest();
    
    setTimeout(() => {
        if (!viteMessageDetected) {
            checkViteAssets();
        }
    }, 3000);
});

function updateViteStatus(isWorking) {
    const statusEl = document.getElementById('vite-status');
    const buildEl = document.getElementById('build-status');
    
    if (isWorking) {
        statusEl.textContent = '‚úÖ';
        statusEl.className = 'text-xs px-2 py-0.5 rounded-full bg-green-50 text-green-700';
        buildEl.textContent = 'OK';
    } else {
        statusEl.textContent = '‚ö†Ô∏è';
        statusEl.className = 'text-xs px-2 py-0.5 rounded-full bg-yellow-50 text-yellow-700';
        buildEl.textContent = 'Sin HMR';
    }
}

function checkManifest() {
    fetch('/static/dist/manifest.json')
        .then(response => {
            if (response.ok) {
                document.getElementById('build-status').textContent = 'OK';
                return response.json();
            }
            throw new Error('Not found');
        })
        .catch(() => {
            document.getElementById('build-status').textContent = 'Error';
        });
}

function checkViteAssets() {
    const viteElements = document.querySelectorAll('[data-vite-dev-id], script[src*="vite"], link[href*="vite"]');
    if (viteElements.length > 0) {
        updateViteStatus(false);
    }
}

// Verificaci√≥n de HTMX
document.addEventListener('htmx:loaded', function(event) {
    const statusEl = document.getElementById('htmx-status');
    const versionEl = document.getElementById('htmx-version');
    
    statusEl.textContent = '‚úÖ';
    statusEl.className = 'text-xs px-2 py-0.5 rounded-full bg-green-50 text-green-700';
    
    if (event.detail && event.detail.version) {
        versionEl.textContent = 'v' + event.detail.version;
    } else if (window.htmx && window.htmx.version) {
        versionEl.textContent = 'v' + window.htmx.version;
    } else {
        versionEl.textContent = 'v2.0.4';
    }
});

// Fallback HTMX
setTimeout(() => {
    const statusEl = document.getElementById('htmx-status');
    if (statusEl.textContent === 'üîÑ') {
        statusEl.textContent = '‚ùå';
        statusEl.className = 'text-xs px-2 py-0.5 rounded-full bg-red-50 text-red-700';
        document.getElementById('htmx-version').textContent = 'No detectado';
    }
}, 5000);
</script>
{% endblock %} 